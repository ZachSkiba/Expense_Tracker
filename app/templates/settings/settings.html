<!DOCTYPE html>
<html>
<head>
    <title>Settings - {{ group.name}}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tracker/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/settings/settings-page.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/settings/settings_cont.css') }}">

</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <h1>âš™ï¸ Settings</h1>
        </div>
        <div class="header-center">
            <nav class="header-nav">
                <a href="{{ url_for('expenses.group_tracker', group_id=group.id) }}">ğŸ  Home</a>
                <a href="{{ url_for('expenses.group_expenses', group_id=group.id) }}">ğŸ“Š View Expenses</a>
                <a href="{{ url_for('balances.combined_balances_settlements', group_id=group.id) }}">ğŸ’° Balances & Settlements</a>
                <a href="{{ url_for('management.manage_data', group_id=group.id) }}">ğŸ› ï¸ Manage Users & Categories</a>
                <a href="{{ url_for('dashboard.home') }}">âš“ Dashboard</a>
            </nav>
        </div>
    </div>

    <div class="settings-container">
        <!-- Group Information & Invite Code -->
        <div class="settings-section">
            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h2 class="section-title">{{ group.name }} - Group Information</h2>
            {% if group.creator_id == current_user.id or current_user.is_group_admin(group) %}
            <button id="editToggleBtn" class="edit-toggle-btn" onclick="toggleEditMode()">
                <span id="editBtnText">âœï¸ Edit</span>
            </button>
            {% endif %}
        </div>
            
            <div class="invite-code-item">
                <div class="invite-code-left">
                    <div class="invite-code-icon">ğŸ”—</div>
                    <div class="invite-code-info">
                        <div class="invite-code-name">Invite Code</div>
                        <div class="invite-code-description">Share this code with friends to invite them</div>
                    </div>
                </div>
                <div class="invite-code-right">
                    <div class="invite-code-value" id="inviteCode">{{ group.invite_code }}</div>
                    <button class="copy-button" onclick="copyInviteCode()">ğŸ“‹ Copy</button>
                </div>
            </div>
            
            <div class="group-info-item editable-item" data-field="name">
                <span class="group-info-label">Group Name</span>
                <div class="group-info-value-container">
                    <span class="group-info-value editable-value" id="groupName">{{ group.name }}</span>
                    <input type="text" class="group-info-edit hidden" id="groupNameEdit" value="{{ group.name }}" maxlength="100">
                </div>
            </div>
            
            <div class="group-info-item editable-item" data-field="description">
                <span class="group-info-label">Description</span>
                <div class="group-info-value-container">
                    <span class="group-info-value editable-value" id="groupDescription">{{ group.description or 'No description' }}</span>
                    <textarea class="group-info-edit hidden" id="groupDescriptionEdit" maxlength="500" rows="2">{{ group.description or '' }}</textarea>
                </div>
            </div>
            
            <div class="group-info-item">
                <span class="group-info-label">Members</span>
                <span class="group-info-value">{{ group.get_member_count() }} people</span>
            </div>
            
            <div class="group-info-item">
                <span class="group-info-label">Created</span>
                <span class="group-info-value">{{ group.created_at.strftime('%B %d, %Y') }}</span>
            </div>
            
            <div class="group-info-item">
                <span class="group-info-label">Your Role</span>
                <span class="group-info-value">
                    {% if group.creator_id == current_user.id %}
                        Admin (Creator)
                    {% elif current_user.is_group_admin(group) %}
                        Admin
                    {% else %}
                        Member
                    {% endif %}
                </span>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="settings-section">
            <div class="section-header">
                <h2 class="section-title">Quick Actions</h2>
            </div>

            <a href="{{ url_for('expenses.group_tracker', group_id=group.id) }}" class="setting-item">
                <div class="setting-left">
                    <div class="setting-icon primary">ğŸ </div>
                    <div class="setting-info">
                        <div class="setting-name">Home</div>
                        <div class="setting-description">Record a shared expense with roommates</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="setting-arrow">â€º</span>
                </div>
            </a>

            <a href="{{ url_for('expenses.group_expenses', group_id=group.id) }}" class="setting-item">
                <div class="setting-left">
                    <div class="setting-icon primary">ğŸ“Š</div>
                    <div class="setting-info">
                        <div class="setting-name">View All Expenses</div>
                        <div class="setting-description">Browse and filter your expense history</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="setting-arrow">â€º</span>
                </div>
            </a>

            <a href="{{ url_for('balances.combined_balances_settlements', group_id=group.id) }}" class="setting-item">
                <div class="setting-left">
                    <div class="setting-icon success">ğŸ’°</div>
                    <div class="setting-info">
                        <div class="setting-name">Balances & Settlements</div>
                        <div class="setting-description">Log a payment between roommates</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="setting-arrow">â€º</span>
                </div>
            </a>

            <a href="{{ url_for('management.manage_data', group_id=group.id) }}" class="setting-item">
                <div class="setting-left">
                    <div class="setting-icon warning">ğŸ› ï¸</div>
                    <div class="setting-info">
                        <div class="setting-name">Manage Users & Categories</div>
                        <div class="setting-description">Add or remove roommates and expense categories</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="setting-arrow">â€º</span>
                </div>
            </a>
        <a href="{{ url_for('dashboard.home') }}" class="setting-item">
            <div class="setting-left">
                <div class="setting-icon purple">âš“</div>
                <div class="setting-info">
                    <div class="setting-name">Dashboard</div>
                    <div class="setting-description">View your personal dashboard and manage all your groups</div>
                </div>
            </div>
            <div class="setting-right">
                <span class="setting-arrow">â€º</span>
            </div>
        </a>
        </div>

        <!-- Appearance -->
        <div class="settings-section">
            <div class="section-header">
                <h2 class="section-title">Appearance</h2>
            </div>
            
            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸŒ™</div>
                    <div class="setting-info">
                        <div class="setting-name">Dark Mode</div>
                        <div class="setting-description">Switch between light and dark themes</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <div class="toggle-switch disabled"></div>
                </div>
            </div>

            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ¨</div>
                    <div class="setting-info">
                        <div class="setting-name">Theme Color</div>
                        <div class="setting-description">Customize the app's accent color</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <span class="setting-value">Blue</span>
                    <span class="setting-arrow">â€º</span>
                </div>
            </div>
        </div>

        <!-- Data & Privacy -->
        <div class="settings-section">
            <div class="section-header">
                <h2 class="section-title">Data & Privacy</h2>
            </div>
            
            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ“¤</div>
                    <div class="setting-info">
                        <div class="setting-name">Export Data</div>
                        <div class="setting-description">Download your expenses as CSV or Excel</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <span class="setting-arrow">â€º</span>
                </div>
            </div>

            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ“¥</div>
                    <div class="setting-info">
                        <div class="setting-name">Import Data</div>
                        <div class="setting-description">Import expenses from other apps</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <span class="setting-arrow">â€º</span>
                </div>
            </div>

            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ’¾</div>
                    <div class="setting-info">
                        <div class="setting-name">Backup & Restore</div>
                        <div class="setting-description">Create and restore data backups</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <span class="setting-arrow">â€º</span>
                </div>
            </div>
        </div>

        <!-- Notifications -->
        <div class="settings-section">
            <div class="section-header">
                <h2 class="section-title">Notifications</h2>
            </div>
            
            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ””</div>
                    <div class="setting-info">
                        <div class="setting-name">Payment Reminders</div>
                        <div class="setting-description">Get notified when payments are due</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <div class="toggle-switch disabled"></div>
                </div>
            </div>

            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ“§</div>
                    <div class="setting-info">
                        <div class="setting-name">Email Summaries</div>
                        <div class="setting-description">Weekly expense summaries via email</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <div class="toggle-switch disabled"></div>
                </div>
            </div>
        </div>

        <!-- Preferences -->
        <div class="settings-section">
            <div class="section-header">
                <h2 class="section-title">Preferences</h2>
            </div>
            
            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ’±</div>
                    <div class="setting-info">
                        <div class="setting-name">Currency</div>
                        <div class="setting-description">Change the default currency</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <span class="setting-value">USD ($)</span>
                    <span class="setting-arrow">â€º</span>
                </div>
            </div>

            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ”„</div>
                    <div class="setting-info">
                        <div class="setting-name">Auto-Sync</div>
                        <div class="setting-description">Automatically sync data across devices</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <div class="toggle-switch disabled"></div>
                </div>
            </div>

            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ“Š</div>
                    <div class="setting-info">
                        <div class="setting-name">Default View</div>
                        <div class="setting-description">Choose what you see when opening the app</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <span class="setting-value">Home</span>
                    <span class="setting-arrow">â€º</span>
                </div>
            </div>
        </div>

        <!-- Support -->
        <div class="settings-section">
            <div class="section-header">
                <h2 class="section-title">Support</h2>
            </div>
            
            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">â“</div>
                    <div class="setting-info">
                        <div class="setting-name">Help & FAQ</div>
                        <div class="setting-description">Get answers to common questions</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <span class="setting-arrow">â€º</span>
                </div>
            </div>

            <div class="setting-item disabled">
                <div class="setting-left">
                    <div class="setting-icon">ğŸ›</div>
                    <div class="setting-info">
                        <div class="setting-name">Report a Bug</div>
                        <div class="setting-description">Help us improve the app</div>
                    </div>
                </div>
                <div class="setting-right">
                    <span class="coming-soon-badge">Coming Soon</span>
                    <span class="setting-arrow">â€º</span>
                </div>
            </div>
        </div>
    
        <!-- Danger Zone Section -->
        <div class="danger-zone-section">
            <div class="danger-zone-header">
                <h3 class="danger-zone-title">âš ï¸ Danger Zone</h3>
            </div>
            
            <!-- Manage Admin Rights (Admin only) -->
            {% if group.creator_id == current_user.id or current_user.is_group_admin(group) %}
            <div class="manage-admin-item">
                <div class="manage-admin-left">
                    <div class="manage-admin-icon">ğŸ‘‘</div>
                    <div class="manage-admin-info">
                        <div class="manage-admin-name">Manage Admin Rights</div>
                        <div class="manage-admin-description">
                            Select which members should have admin privileges. Multiple admins are allowed.
                        </div>
                    </div>
                </div>
                <div class="manage-admin-right">
                    <button class="manage-admin-button" onclick="showManageAdminsModal()">
                        ğŸ‘‘ Manage Admins
                    </button>
                </div>
            </div>
            {% endif %}

            <!-- Leave Group (for all members) -->
            {% if current_user in group.members %}
            <div class="leave-group-item">
                <div class="leave-group-left">
                    <div class="leave-group-icon">ğŸšª</div>
                    <div class="leave-group-info">
                        <div class="leave-group-name">Leave Group</div>
                        <div class="leave-group-description">
                            {% if group.creator_id == current_user.id %}
                            Transfer admin rights and leave this group permanently.
                            {% else %}
                            Leave this group permanently. You can only leave if you have no outstanding balances or financial involvement.
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="leave-group-right">
                    <button class="leave-group-button" onclick="showLeaveConfirmation()">
                        ğŸšª Leave Group
                    </button>
                </div>
            </div>
            {% endif %}
            
            <!-- Delete Group (Admin only) -->
            {% if group.creator_id == current_user.id or current_user.is_group_admin(group) %}
            <div class="delete-group-item">
                <div class="delete-group-left">
                    <div class="delete-group-icon">ğŸ—‘ï¸</div>
                    <div class="delete-group-info">
                        <div class="delete-group-name">Delete Group</div>
                        <div class="delete-group-description">
                            Permanently delete this group and all associated data. This action cannot be undone.
                        </div>
                    </div>
                </div>
                <div class="delete-group-right">
                    <button class="delete-group-button" onclick="showDeleteConfirmation()">
                        ğŸ—‘ï¸ Delete Group
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

            <!-- Manage Admin Rights Modal -->
        <div id="manageAdminsModal" class="modal-overlay" style="display: none;">
            <div class="modal-content manage-admin-modal">
                <div class="modal-header">
                    <h2 class="modal-title">ğŸ‘‘ Manage Admin Rights</h2>
                </div>
                
                <div class="modal-body">
                    <div class="info-message">
                        <div class="info-icon">â„¹ï¸</div>
                        <div class="info-text">
                            <strong>Select who should be group admins</strong><br>
                            Admins can edit group settings, manage members, and delete the group.
                            At least one admin must be selected.
                        </div>
                    </div>
                    
                    <div class="admin-selection-section">
                        <label>Group Members:</label>
                        <div class="member-checkboxes" id="memberCheckboxes">
                            {% for member in group.members %}
                            <div class="member-checkbox-item">
                                <input type="checkbox" 
                                    id="admin_{{ member.id }}" 
                                    value="{{ member.id }}"
                                    {% if member.is_group_admin(group) or group.creator_id == member.id %}checked{% endif %}>
                                <label for="admin_{{ member.id }}">
                                    <span class="member-name">{{ member.name }}</span>
                                    {% if group.creator_id == member.id %}
                                        <span class="creator-badge">Creator</span>
                                    {% endif %}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="modal-btn modal-btn-cancel" onclick="hideManageAdminsModal()">
                        Cancel
                    </button>
                    <button class="modal-btn modal-btn-save" id="saveAdminsBtn" onclick="saveAdminRights()">
                        ğŸ’¾ Save Admin Rights
                    </button>
                </div>
            </div>
        </div>

    <!-- Leave Group Confirmation Modal -->
    <div id="leaveConfirmationModal" class="modal-overlay" style="display: none;">
        <div class="modal-content leave-modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸšª Leave Group</h2>
            </div>
            
            <div class="modal-body">
                <div class="warning-message">
                    <div class="warning-icon">âš ï¸</div>
                    <div class="warning-text">
                        <strong>Are you sure you want to leave?</strong><br>
                        You will no longer have access to this group's expenses and data.
                        <br><br>
                        <strong>Note:</strong> You can only leave if you have no outstanding balances, unpaid expenses, or financial involvement in this group.
                    </div>
                </div>
                
                <div class="confirmation-input">
                    <label for="leaveConfirmation">Type <strong>"leave"</strong> to confirm:</label>
                    <input type="text" id="leaveConfirmation" placeholder="Type 'leave' here" autocomplete="off">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="hideLeaveConfirmation()">
                    Cancel
                </button>
                <button class="modal-btn modal-btn-leave" id="confirmLeaveBtn" onclick="confirmLeaveGroup()" disabled>
                    ğŸšª Leave Group
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmationModal" class="modal-overlay" style="display: none;">
        <div class="modal-content delete-modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ—‘ï¸ Delete Group</h2>
            </div>
            
            <div class="modal-body">
                <div class="warning-message">
                    <div class="warning-icon">âš ï¸</div>
                    <div class="warning-text">
                        <strong>This action cannot be undone!</strong><br>
                        This will permanently delete the group "{{ group.name }}" and all associated:
                        <ul>
                            <li>Expenses and transactions</li>
                            <li>Balances and settlements</li>
                            <li>Categories and member data</li>
                            <li>All group history</li>
                        </ul>
                    </div>
                </div>
                
                <div class="confirmation-input">
                    <label for="deleteConfirmation">Type <strong>"delete"</strong> to confirm:</label>
                    <input type="text" id="deleteConfirmation" placeholder="Type 'delete' here" autocomplete="off">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="hideDeleteConfirmation()">
                    Cancel
                </button>
                <button class="modal-btn modal-btn-delete" id="confirmDeleteBtn" onclick="confirmDeleteGroup()" disabled>
                    ğŸ—‘ï¸ Delete Group Forever
                </button>
            </div>
        </div>
    </div>

    <script>
      window.groupId = "{{ group.id }}";
      window.groupName = "{{ group.name }}";
    </script>
    <!-- Include settings JavaScript module -->
    <script src="{{ url_for('static', filename='js/modules/settings.js') }}"></script>
</body>
</html>