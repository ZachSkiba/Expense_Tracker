{# templates/_expenses_table.html #}
<h3>All Expenses</h3>
<div id="table-error" style="margin: 8px 0;"></div>
<table>
    <thead>
        <tr>
            <th>Amount</th>
            <th>Category</th>
            <th>Description</th>
            <th>Paid By</th>
            {% if show_participants %}
            <th>Participants</th>
            {% endif %}
            <th>Date</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for expense in expenses %}
        <tr data-expense-id="{{ expense.id }}">
            <td class="editable amount" data-value="{{ "%.2f"|format(expense.amount) }}">
                ${{ "%.2f"|format(expense.amount) }}
            </td>
            <td class="editable category" data-value="{{ expense.category_obj.name }}">
                {{ expense.category_obj.name }}
            </td>
            <td class="editable description" data-value="{{ expense.category_description or '' }}">
                {{ expense.category_description or '' }}
            </td>
            <td class="editable user" data-value="{{ expense.user.name }}">
                {{ expense.user.name }}
            </td>
            {% if show_participants %}
            <td class="editable participants" 
                data-value="{{ expense.participants|map(attribute='user.name')|join(',') }}"
                data-participant-ids="{{ expense.participants|map(attribute='user_id')|join(',') }}"
                style="font-size: 0.85rem; color: #666;">
                {% if expense.participants %}
                    {% for participant in expense.participants %}
                        <span class="participant-tag">{{ participant.user.name }}</span>{% if not loop.last %}, {% endif %}
                    {% endfor %}
                    <div style="font-size: 0.75rem; color: #999; margin-top: 2px;">
                        ({{ expense.participants|length }} people, ${{ "%.2f"|format(expense.amount / expense.participants|length) }} each)
                    </div>
                {% else %}
                    <span style="color: #999; font-style: italic;">No participants</span>
                {% endif %}
            </td>
            {% endif %}
            <td class="editable date" data-value="{{ expense.date.strftime('%Y-%m-%d') }}">
                {{ expense.date.strftime('%Y-%m-%d') }}
            </td>
            <td>
                <button class="delete-btn" data-expense-id="{{ expense.id }}">‚ùå Delete</button>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="{% if show_participants %}7{% else %}6{% endif %}" style="text-align: center; color: #888;">No expenses found</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<style>
.participant-tag {
    display: inline-block;
    background: #e8f4fd;
    color: #2980b9;
    padding: 2px 6px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
    margin: 1px;
}

.participants {
    max-width: 200px;
    word-wrap: break-word;
}

/* Ensure table cells don't get too cramped */
td.participants {
    padding: 8px;
    vertical-align: top;
}

/* Participants editing styling */
td.participants.editable {
    cursor: pointer;
    position: relative;
}

td.participants.editable:hover {
    background-color: #e9ecef;
}

/* Style the participants editor */
.participants-editor {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: white;
    border: 2px solid #3498db;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 250px;
}
</style>